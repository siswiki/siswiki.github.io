<!DOCTYPE html>
<html lang="hr" dir="ltr">
<head>
<meta charset="UTF-8" />
<title>Nginx - SIS Wiki</title>
<meta name="generator" content="MediaWiki 1.17.0" />
<link rel="shortcut icon" href="http://security.foi.hr/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="../opensearch_desc.php" title="SIS Wiki (hr)" />
<link rel="EditURI" type="application/rsd+xml" href="../api.php%3Faction=rsd" />
<link title="Creative Commons" type="application/rdf+xml" href="http://security.foi.hr/wiki/index.php?title=Nginx&amp;action=creativecommons" rel="meta" />
<link rel="copyright" href="http://creativecommons.org/licenses/by-sa/3.0/" />
<link rel="alternate" type="application/atom+xml" title="SIS Wiki Atom izvor" href="../index.php%3Ftitle=Posebno:Nedavne_promjene&amp;feed=atom" />
<link rel="stylesheet" href="../load.php%3Fdebug=false&amp;lang=hr&amp;modules=mediawiki.legacy.commonPrint%252Cshared%257Cskins.vector&amp;only=styles&amp;skin=vector&amp;*.css" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<!--[if lt IE 7]><style type="text/css">body{behavior:url("/wiki/skins/vector/csshover.min.htc")}</style><![endif]--></head>
<body class="mediawiki ltr ns-0 ns-subject page-Nginx skin-vector">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<!-- content -->
		<div id="content">
			<a id="top"></a>
			<div id="mw-js-message" style="display:none;"></div>
						<!-- firstHeading -->
			<h1 id="firstHeading" class="firstHeading">Nginx</h1>
			<!-- /firstHeading -->
			<!-- bodyContent -->
			<div id="bodyContent">
				<!-- tagline -->
				<div id="siteSub">Izvor: SIS Wiki</div>
				<!-- /tagline -->
				<!-- subtitle -->
				<div id="contentSub"></div>
				<!-- /subtitle -->
																<!-- jumpto -->
				<div id="jump-to-nav">
					Skoči na: <a href="Nginx.html#mw-head">orijentacija</a>,
					<a href="Nginx.html#p-search">traži</a>
				</div>
				<!-- /jumpto -->
								<!-- bodytext -->
				<p>Davor Tomala
</p><p>Luka Rajčević
</p>
<div class="center"><div class="floatnone"><a href="http://security.foi.hr/wiki/index.php/Datoteka:Nginx_logo.gif" class="image"><img alt="Nginx logo.gif" src="../images/0/04/Nginx_logo.gif" width="320" height="220" /></a></div></div>
<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>Sadržaj</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="Nginx.html#Uvod"><span class="tocnumber">1</span> <span class="toctext">Uvod</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="Nginx.html#Karakteristike_Nginx-a"><span class="tocnumber">2</span> <span class="toctext">Karakteristike Nginx-a</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="Nginx.html#Poslu.C5.BEivanje_stati.C4.8Dnih_web_stranica"><span class="tocnumber">2.1</span> <span class="toctext">Posluživanje statičnih web stranica</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="Nginx.html#Podr.C5.A1ka_za_SSL.2FTLS"><span class="tocnumber">2.2</span> <span class="toctext">Podrška za SSL/TLS</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="Nginx.html#Podr.C5.A1ka_za_virtualne_hostove"><span class="tocnumber">2.3</span> <span class="toctext">Podrška za virtualne hostove</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="Nginx.html#Mogu.C4.87nost_kompresije_response-a_sa_servera"><span class="tocnumber">2.4</span> <span class="toctext">Mogućnost kompresije response-a sa servera</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="Nginx.html#Fault_tolerance"><span class="tocnumber">2.5</span> <span class="toctext">Fault tolerance</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="Nginx.html#Jednostavna_kontrola_pristupa"><span class="tocnumber">2.6</span> <span class="toctext">Jednostavna kontrola pristupa</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-9"><a href="Nginx.html#Reverse_proxy"><span class="tocnumber">3</span> <span class="toctext">Reverse proxy</span></a></li>
<li class="toclevel-1 tocsection-10"><a href="Nginx.html#Arhitektura"><span class="tocnumber">4</span> <span class="toctext">Arhitektura</span></a>
<ul>
<li class="toclevel-2 tocsection-11"><a href="Nginx.html#Struktura_koda"><span class="tocnumber">4.1</span> <span class="toctext">Struktura koda</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="Nginx.html#Worker"><span class="tocnumber">4.2</span> <span class="toctext">Worker</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="Nginx.html#Uloge_procesa"><span class="tocnumber">4.3</span> <span class="toctext">Uloge procesa</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-14"><a href="Nginx.html#Instalacija_nginx-a"><span class="tocnumber">5</span> <span class="toctext">Instalacija nginx-a</span></a></li>
<li class="toclevel-1 tocsection-15"><a href="Nginx.html#Konfiguracija_PHP-a_na_nginxu"><span class="tocnumber">6</span> <span class="toctext">Konfiguracija PHP-a na nginxu</span></a>
<ul>
<li class="toclevel-2 tocsection-16"><a href="Nginx.html#CGI_i_FastCGI"><span class="tocnumber">6.1</span> <span class="toctext">CGI i FastCGI</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="Nginx.html#Instalacija_i_pode.C5.A1avanje_PHP-a"><span class="tocnumber">6.2</span> <span class="toctext">Instalacija i podešavanje PHP-a</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-18"><a href="Nginx.html#Sigurnost_.28najbolja_praksa.29"><span class="tocnumber">7</span> <span class="toctext">Sigurnost (najbolja praksa)</span></a>
<ul>
<li class="toclevel-2 tocsection-19"><a href="Nginx.html#Config_fileovi_i_portovi"><span class="tocnumber">7.1</span> <span class="toctext">Config fileovi i portovi</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="Nginx.html#SELinux"><span class="tocnumber">7.2</span> <span class="toctext">SELinux</span></a></li>
<li class="toclevel-2 tocsection-21"><a href="Nginx.html#Minimalne_privilegije_preko_Mount_opcija"><span class="tocnumber">7.3</span> <span class="toctext">Minimalne privilegije preko Mount opcija</span></a></li>
<li class="toclevel-2 tocsection-22"><a href="Nginx.html#Linux_.2Fetx.2Fsysctl.conf_Hardening"><span class="tocnumber">7.4</span> <span class="toctext">Linux /etx/sysctl.conf Hardening</span></a></li>
<li class="toclevel-2 tocsection-23"><a href="Nginx.html#Micanje_svih_ne.C5.BEeljenih_nginx_modula"><span class="tocnumber">7.5</span> <span class="toctext">Micanje svih neželjenih nginx modula</span></a></li>
<li class="toclevel-2 tocsection-24"><a href="Nginx.html#Instalacija_SELinux_Policy_za_za.C5.A1titu_nginx_webservera"><span class="tocnumber">7.6</span> <span class="toctext">Instalacija SELinux Policy za zaštitu nginx webservera</span></a></li>
<li class="toclevel-2 tocsection-25"><a href="Nginx.html#Restriktivan_firewall_temeljen_na_iptables-ima"><span class="tocnumber">7.7</span> <span class="toctext">Restriktivan firewall temeljen na iptables-ima</span></a></li>
<li class="toclevel-2 tocsection-26"><a href="Nginx.html#Kontrola_Buffer_Overflow_napada"><span class="tocnumber">7.8</span> <span class="toctext">Kontrola Buffer Overflow napada</span></a></li>
<li class="toclevel-2 tocsection-27"><a href="Nginx.html#Kontrola_istovremenih_konekcija"><span class="tocnumber">7.9</span> <span class="toctext">Kontrola istovremenih konekcija</span></a></li>
<li class="toclevel-2 tocsection-28"><a href="Nginx.html#Dopu.C5.A1tanje_pristupa_samo_vlastitoj_domeni"><span class="tocnumber">7.10</span> <span class="toctext">Dopuštanje pristupa samo vlastitoj domeni</span></a></li>
<li class="toclevel-2 tocsection-29"><a href="Nginx.html#Ograni.C4.8Denje_dostupnih_metoda"><span class="tocnumber">7.11</span> <span class="toctext">Ograničenje dostupnih metoda</span></a></li>
<li class="toclevel-2 tocsection-30"><a href="Nginx.html#Odbijanje_pojedinih_.E2.80.9EUser-Agent.E2.80.9C-a"><span class="tocnumber">7.12</span> <span class="toctext">Odbijanje pojedinih „User-Agent“-a</span></a></li>
<li class="toclevel-2 tocsection-31"><a href="Nginx.html#Blokiranje_upu.C4.87enog_spama"><span class="tocnumber">7.13</span> <span class="toctext">Blokiranje upućenog spama</span></a></li>
<li class="toclevel-2 tocsection-32"><a href="Nginx.html#Zaustavljanje_.E2.80.9EImage_Hotlinking.E2.80.9C-a"><span class="tocnumber">7.14</span> <span class="toctext">Zaustavljanje „Image Hotlinking“-a</span></a></li>
<li class="toclevel-2 tocsection-33"><a href="Nginx.html#Restrikcije_direktorija"><span class="tocnumber">7.15</span> <span class="toctext">Restrikcije direktorija</span></a></li>
<li class="toclevel-2 tocsection-34"><a href="Nginx.html#nginx_SSL_konfiguracija"><span class="tocnumber">7.16</span> <span class="toctext">nginx SSL konfiguracija</span></a></li>
<li class="toclevel-2 tocsection-35"><a href="Nginx.html#nginx_i_PHP_sigurnosni_savjeti"><span class="tocnumber">7.17</span> <span class="toctext">nginx i PHP sigurnosni savjeti</span></a></li>
<li class="toclevel-2 tocsection-36"><a href="Nginx.html#nginx_u_Chroot_Jail-u_.28kontejneru.29"><span class="tocnumber">7.18</span> <span class="toctext">nginx u Chroot Jail-u (kontejneru)</span></a></li>
<li class="toclevel-2 tocsection-37"><a href="Nginx.html#Ograni.C4.8Davanje_konekcija_po_IP-u_na_razini_firewall-a"><span class="tocnumber">7.19</span> <span class="toctext">Ograničavanje konekcija po IP-u na razini firewall-a</span></a></li>
<li class="toclevel-2 tocsection-38"><a href="Nginx.html#Konfiguriranje_operacijskog_sustava_kako_bi_.C5.A1titio_web_server"><span class="tocnumber">7.20</span> <span class="toctext">Konfiguriranje operacijskog sustava kako bi štitio web server</span></a></li>
<li class="toclevel-2 tocsection-39"><a href="Nginx.html#Zabrana_odlaznih_nginx_konekcija"><span class="tocnumber">7.21</span> <span class="toctext">Zabrana odlaznih nginx konekcija</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-40"><a href="Nginx.html#Literatura"><span class="tocnumber">8</span> <span class="toctext">Literatura</span></a></li>
<li class="toclevel-1 tocsection-41"><a href="Nginx.html#Podjela_rada"><span class="tocnumber">9</span> <span class="toctext">Podjela rada</span></a></li>
</ul>
</td></tr></table>
<h2> <span class="mw-headline" id="Uvod"> Uvod </span></h2>
<p>Nginx je Web server i reverse proxy server otvorenog koda. Protokoli koje podržava su HTTP, SMTP, POP3 i IMAP. Razvijen je (i još uvijek se razvija) u Rusiji 2002. godine. Razvio ga je Igor Sysoev. Ovaj web server ima kvalitete koje ga izdižu iznad konkurencije (Apache/IIS) i koje ćemo prikazati u daljnjem tekstu. Iako je trenutno tek treći po broju web stranica koje ga koriste, njegova popularnost i korištenje svakodnevno rastu pogotov na stranicama na kojima se odvija velik promet, tj. na kojima se generira velik broj zahtjeva prema serveru. Zašto je to tako, objasniti ćemo u slijedećim odlomcima.<br />
Na slici se može vidjeti statistika korištenja web servera. Slika je preuzeta sa <a href="http://w3techs.com/technologies/overview/web_server/all" class="external autonumber" rel="nofollow">[1]</a> i prikazuje postotak web stranica koje koriste određeni web server. Ovi podaci su novi (statistika je napravljena 16. 01. 2013.). Na njima nginx zauzima treće mjesto, a najkorišteniji je Apache web server. Međutim kada bi pogledali popis stranica koje koriste nginx za posluživanje svojih stranica vidjeli bi da su to neke od najpoznatijih stranica/aplikacija poput facebook.com, hulu.com, tumblr.com, pinterest.com, wordpress.com, about.com ili cnn.com.
</p>
<div class="thumb tright"><div class="thumbinner" style="width:182px;"><a href="http://security.foi.hr/wiki/index.php/Datoteka:500px-usage_of_nginx.jpg" class="image"><img alt="500px-usage of nginx.jpg" src="../images/thumb/f/f8/500px-usage_of_nginx.jpg/180px-500px-usage_of_nginx.jpg" width="180" height="224" class="thumbimage" /></a>  <div class="thumbcaption"><div class="magnify"><a href="http://security.foi.hr/wiki/index.php/Datoteka:500px-usage_of_nginx.jpg" class="internal" title="Povećaj"><img src="../skins/common/images/magnify-clip.png" width="15" height="11" alt="" /></a></div></div></div></div>
<div class="center"><div class="floatnone"><a href="http://security.foi.hr/wiki/index.php/Datoteka:Web_servers_statistics_2013.png" class="image"><img alt="Web servers statistics 2013.png" src="../images/a/a3/Web_servers_statistics_2013.png" width="425" height="375" /></a></div></div>
<p><br />
</p>
<h2> <span class="mw-headline" id="Karakteristike_Nginx-a"> Karakteristike Nginx-a </span></h2>
<p>Izvori: <a href="http://en.wikipedia.org/wiki/Nginx" class="external autonumber" rel="nofollow">[2]</a> <a href="http://wiki.nginx.org/Main" class="external autonumber" rel="nofollow">[3]</a>
</p><p>Web Server je software čija je primarna funkcija "dostavljanje" web stranica na korisnički zahtjev korištenjem HTTP protokola. To uključuje HTML dokumente i svaki drugi dodatni sadržaj koji može biti uključen u dokument kao npr. slike, skripte i sl. Nginx je takav software te, kao (gotovo) svaki web server, između ostalih ima slijedeće bitne funkcionalnosti:
</p>
<h3> <span class="mw-headline" id="Poslu.C5.BEivanje_stati.C4.8Dnih_web_stranica">Posluživanje statičnih web stranica</span></h3>
<p>kao i svakom web serveru, osnovna funkcionalnost nginx-a je posluživanje statičkih web stranica. Nginx je nakon instalacije već podešen za posluživanje običnih HTML stranica tako da nije potrebno dodatno podešavanje. Ukoliko ipak nismo zadovoljni samo s HTML-om i statičkim stranicama, nginx podržava CGI / FastCGI za posluživanje dinamičkog sadržaja korisnicima. U ovom projektu će biti prikazano kako je moguće iskoristiti nginx za kreiranje dinamičkih stranica u PHP programskom jeziku.
</p>
<h3> <span class="mw-headline" id="Podr.C5.A1ka_za_SSL.2FTLS">Podrška za SSL/TLS</span></h3>
<p>SSL i TLS su kriptografski protokoli koji omogućavaju sigurnu komunikaciju preko mreže (interneta). Nginx ima modul koji omogućuje korištenje tih protokola za sigurniji pristup podacima, HttpSslModule. U tom modulu se mogu podesiti sve pojedinosti SSL-a kao što je generiranje i potpisivanje certifikata.
</p>
<h3> <span class="mw-headline" id="Podr.C5.A1ka_za_virtualne_hostove">Podrška za virtualne hostove</span></h3>
<p>pojam korištenja virtualnih hostova je metoda kojom se na jednom serveru u isto vrijeme nalaze stranice s različitim nazivima domena. Korištenje virtualnih hostova omogućava serveru da dijeli vlastite resurse (memoriju i procesorsku snagu) među servisima koji ne moraju nužno imati isti hostname. Takve usluge su puno jeftinije od npr. dedicated web servera jer se više koristnika može nalaziti na istom serveru i međusobno koristiti iste resurse. To se još naziva i shared web hosting. U nastavku ovog rada će također biti objašnjeno na koji način se jednostavno može dodati novi virtualni host.
</p>
<h3> <span class="mw-headline" id="Mogu.C4.87nost_kompresije_response-a_sa_servera">Mogućnost kompresije response-a sa servera</span></h3>
<p>nginx sadrži module za kompresiju odgovora klijentima. Za kompresiju se koristi gzip metoda. Prednost kompresije je očita, omogućava smanjenje podataka koje treba prenijeti ali u isto vrijeme je potrebno duže čekati na odgovor jer se na serverskoj strani mora obaviti kompresija. Modul koji omogućava takvu <i>on-the-fly</i> kompresiju je HttpGzipModule.
</p>
<h3> <span class="mw-headline" id="Fault_tolerance">Fault tolerance</span></h3>
<p>Nginx je dizajniran tako da prilikom otkazivanja nekog dijela sustava, nastavlja s radom (najčešće sa smanjenim kapacitetom). 
</p>
<h3> <span class="mw-headline" id="Jednostavna_kontrola_pristupa">Jednostavna kontrola pristupa</span></h3>
<p>nginx omogućava jednostavno postavljanje pravila za kontrolu pristupa. Na vrlo jednostavan način je moguće dozvoliti ili zabraniti pristup serveru za pojedine korisnike ili mreže. Za to postoji modul nginx_http_access_module kojim se na vrlo jednostavan način blokira ili dozvoljava pristup pojedinim IP adresama. Primjer konfiguracije bi mogao biti npr. ovakav:
</p>
<pre>
location / {
  deny    192.168.1.1;
  allow   192.168.1.0/24;
  allow   10.1.1.0/16;
  allow   2620:100:e000::8001;
  deny    all;
}
</pre>
<p><br />
</p>
<h2> <span class="mw-headline" id="Reverse_proxy"> Reverse proxy </span></h2>
<p>Izvor: <a href="http://en.wikipedia.org/wiki/Reverse_proxy" class="external autonumber" rel="nofollow">[4]</a>
</p><p>Nginx služi i kao reverse proxy server. Reverse proxy je tip proxy servera koji se, za razliku od standardnog (forward) proxy-ja postavlja "ispred" web servera. Na taj način se svaki zahtjev prema web serveru ustvari preusmjerava na reverse proxy server. Razloga za to je više. 
</p>
<ul><li> Recimo da posjedujemo web stranicu za kojom vlada velika "potražnja", i milijuni korisnika ju žele posjetiti. Sam web server bi jako teško izdržao toliki promet. Kako bi se ipak osigurao pristup stranici svim korisnicima, na web se postavljaju mnogi serveri sa reverse proxy-jem. Tada sav primet ide na te novopostavljene servere, koji svaki korisnički zahtjev šalju na "pravi" web server koji je njima najbliži. Taj koncept se naziva Content delivery network (CDN).
</li></ul>
<ul><li> Korištenjem reverse proxy-ja je olakšan proces osiguravanja "unutarnjih" HTTP servera. Svi zahtjevi idu preko jedne točke i upravo tu je moguće postaviti prava i privilegije za pojedine korisnike te na taj način kontrolirati cijelu mrežu servera sa jednog mjesta.
</li></ul>
<ul><li> Prilikom postavljanja reverse proxy servera, dovoljno je samo njegovu IP adresu učiniti javnom i dostupnom. IP adrese "pravih" HTTP servera ne moraju biti javne te se i na taj način povećava sigurnost servera. Naravno, na reverse proxy-ju je potrebno napraviti URL mapiranje kako bi se zahtjev prema reverse proxy serveru preveo u zahtjev prema pravom HTTP serveru. 
</li></ul>
<div class="center"><div class="floatnone"><a href="http://security.foi.hr/wiki/index.php/Datoteka:500px-Reverse_proxy_h2g2bob.svg.png" class="image"><img alt="500px-Reverse proxy h2g2bob.svg.png" src="../images/5/54/500px-Reverse_proxy_h2g2bob.svg.png" width="500" height="188" /></a></div></div>
<h2> <span class="mw-headline" id="Arhitektura"> Arhitektura </span></h2>
<p><a href="http://www.aosabook.org/en/nginx.html" class="external autonumber" rel="nofollow">[5]</a>
</p><p>Klasični web serveri koriste procese ili dretve za obradu konkurentnih konekcija, gdje se svaka konekcija obrađuje u zasebnom procesu ili dretvi. Ovisno o aplikaciji, može biti vrlo neefikasno u smislu korištenja memorijskih i procesorskih resursa. Razlog tome su vrijeme i resursi potrebni za kreiranje novog procesa ili dretve, odnosno njegove radne okoline, alociranje memorije (stoga i hrpe), te izvršnog konteksta, čime se smanjuju performanse servera.
</p><p>Razlog nastanka nginx-a bila je upravo ta potreba da se postignu veće performanse, gustoća i ekonomično iskorištavanje serverskih resursa, čime bi se omogućio dinamički rast web stranica. Inspiracija za ovaj model servera je došla od tadašnjeg razvoja naprednih mehanizama temeljenih na događajima (event-based mechanisms) kod raznih operacijskih sustava. Rezultat razvoja je modularna, asinkrona, jedno-dretvena arhitektura temeljena na eventima.
</p><p>Konekcije su procesirane u visoko efikasnom „run-loop“-u s ograničenim brojem jedno-dretvenih procesa  koji se nazivaju workeri, i svaki od njih može obrađivati i po nekoliko tisuća konkurentnih konekcija i zahtjeva po sekundi. 
</p>
<h3> <span class="mw-headline" id="Struktura_koda"> Struktura koda </span></h3>
<p><a href="http://www.aosabook.org/en/nginx.html" class="external autonumber" rel="nofollow">[6]</a>
</p><p>nginx-ov worker uključuje jezgrene i funkcionalne module, čiji dijelovi koda se izvršavaju prilikom svakog procesiranje zahtjeva. Moduli čitaju iz i pišu u memoriju i na mrežu, transformiraju sadržaj, izvršavaju izlazno filtriranje, izvršavaju serverske include akcije i prosljeđuju zahtjeve unutarnjim serverima kada se server koristi kao proxy. 
</p><p>Modularna arhitektura generalno omogućava developerima da prošite skup serverskih funkcionalnosti bez potrebe za modificiranjem nginx-ove jezgre. Moduli dolaze u različitim inkarnacijama, core modules, event modules, phase handlers, protocols, variable handlers, filters, upstreams i load balancers. Nginx trenutno ne podržava dinamičko učitavanje modula, oni se kompiliraju zajedno s jezgrom u fazi izgradnje; no podrška za ovakvo učitavanje modula se planira implementirati u budućim većim izdanjima.
</p><p><br />
</p>
<div class="center"><div class="floatnone"><a href="http://security.foi.hr/wiki/index.php/Datoteka:Arhitektura.png" class="image"><img alt="Arhitektura.png" src="../images/thumb/9/97/Arhitektura.png/600px-Arhitektura.png" width="600" height="373" /></a></div></div>
<p><br />
</p>
<h3> <span class="mw-headline" id="Worker"> Worker </span></h3>
<p><a href="http://www.aosabook.org/en/nginx.html" class="external autonumber" rel="nofollow">[7]</a>
</p><p>Worker proces prihvaća zahtjeve s dijeljenog „listen socket“-a, nakon čega izvršava „run-loop“ unutar svakog workera. Nema specijalizirane raspodijele konekcija između workera u nginx-u, već to obavljaju jezgreni mehanizmi operacijskog sustava. Prilikom pokretanja se stvara inicijalni skup socketa za slušanje preko kojih onda workeri neprestano prihvaćaju, čitaju iz i zapisuju u socket, te procesiraju HTTP zahtjeve i odgovore.
</p><p>Spomenuti „run-loop“ je najkompliciraniji dio nginx-ovog worker koda. Uključuje opsežne unutarnje pozive i oslanja se na rukovanje asinkronim taskovima. Asinkrone operaciju su implementirane preko modularnosti, notifikacija događaja, opsežno korištenje callback funkcija, te timera. Unatoč svemu, nginx može zablokirati kada nema dovoljno diskovnih resursa za worker procese.
</p><p>Kako nginx koristi nekoliko workera za obradu konekcija dobro se skalira s višebrojnim jezgrama. Po jedan worker na svakoj jezgri omogućava potpuno iskorištenje više-jezgrene arhitekture, nema izgladnjivanja resursa, te su mehanizmi kontrole resursa izolirani unutar jedno-dretvenog worker procesa. Ovaj model omogućava veću skalabilnost fizičkih uređaja za pohranu, olakšava bolju iskoristivost diska te obilazi mogućnost blokiranja na diskovnom I/O-u. Rezultat toga je bolja iskoristivost serverskih resursa te efikasna raspodjela opterećenja na nekoliko workera.
</p><p>Broj nginx workera bi se trebao podesiti ovisno o opterećenju procesora ili diska. Ovdje postoje neka jednostavna pravila, i sistem administrator bi trebao isprobati nekoliko konfiguracija i vidjeti koja najbolje odgovara pojedinom opterećenju.
</p><p><br />
Neke od preporuka su: 
</p>
<ul><li> ako se opterećenje odnosi na CPU (rukovanje s TCP/IP-om, SSL, kompresija) - broj nginx workera bi trebao biti jednak broju jezgri CPU-a
</li></ul>
<ul><li> ako se opterećenje odnosi na I/O diska (posluživanje različitog skupa sadržaja iz spremišta, ili proxiranje) – broj workera bi mogao biti jedan i pol do dva puta broj jezgri procesora
</li></ul>
<ul><li> no neki odabiru broj workera ovisno o broju pojedinačnih spremničkih jedinica, no efikasnost ovakvog pristupa ovisi o tipu i konfiguraciji diskovnih spremnika
</li></ul>
<p><br />
</p>
<h3> <span class="mw-headline" id="Uloge_procesa"> Uloge procesa </span></h3>
<p><a href="http://www.aosabook.org/en/nginx.html" class="external autonumber" rel="nofollow">[8]</a>
</p><p>nginx vrti nekoliko procesa u memoriji, jedan glavni (master) proces i nekoliko workera, no postoji i nekoliko procesa posebne namjene kao što je cache loader i cache manager. Svi procesi su jedno-dretveni (nginx v1.x). Komunikacija između procesa je ostvarena shared-memory mehanizmima. Master proces je pokrenut kao root user, dok su cache loader, cache manager i workeri pokrenuti kao neprivilegirani korisnik.
</p><p><br />
Master proces obavlja sljedeće zadatke:
</p>
<ul><li> čitanje i validiranje konfiguracije
</li></ul>
<ul><li> kreiranje, spajanje i zatvaranje socketa
</li></ul>
<ul><li> pokretanje, gašenje i održavanje konfiguriranog broja worker procesa
</li></ul>
<ul><li> rekonfiguriranje bez prekidanja servisa
</li></ul>
<ul><li> kontroliranje neprekidnih binarnih nadogradnji (pokretanje nove ili rollback)
</li></ul>
<ul><li> ponovno otvaranje log-ova
</li></ul>
<ul><li> kompiliranje ugrađenih Perl skripti
</li></ul>
<p><br />
Worker procesi prihvaćaju, obrađuju i procesiraju konekcija od klijenata, pružaju reverzno proxiranje i funkcionalnost filtriranja, te odrađuju gotovo sve što je nginx u mogućnosti ponuditi. Za praćenje ponašanja nginx instance, sistem administrator treba paziti na workere jer oni zapravo reflektiraju svakodnevne operacije web servera. 
</p><p>Cache loader proces je odgovoran za provjeru cachea na disku te popunjavanje nginx-ove in-memory baze podataka s cache meta podacima. Cache loader zapravo priprema nginx instancu za rad s podacima koji su već spremljeni na disku u posebno alociranoj direktorijskoj strukturi. Zaobilazi direktorije, provjerava se sadržaj meta podataka cachea, ažuriraju se važni unosi u dijeljenoj memoriji te izlazi kada je sve čisto i spremno za korištenje.
</p><p>Cache manager je uglavnom odgovoran za istek i poništenje cachea. Ostaje u memoriji tokom normalnih nginx operacija, a master proces ga ponovno pokreće ukoliko se dogodi neka pogreška u radu.
</p><p><br />
</p>
<h2> <span class="mw-headline" id="Instalacija_nginx-a"> Instalacija nginx-a </span></h2>
<p>Instalacija nginx-a je vrlo jednostavna. Ukoliko se nalazimo na linux operacijskom sustavu, potrebno je unijeti samo par naredbi. Instalacija koju ćemo prikazati se obavljala na Ubuntu 12.04 verziji linuxa. Za instalaciju paketa u ubuntu okruženju koristimo standardni način, tako se nginx instalira slijedećom naredbom:
</p>
<pre>sudo apt-get install nginx</pre>
<p>Naravno, za instalaciju je potrebno imati administratorske ovlasti. Nakon što je instalacija završena, nginx se ne pokreće automatski nego ga je potrebno pokrenuti ručno. Da bi to napravili moramo otići u slijedeći direktorij:
</p>
<pre> cd etc/init.d/ </pre>
<p>te nakon toga pokrenuti slijedeću naredbu
</p>
<pre> 
&gt; sudo ./nginx start 
Starting nginx: nginx.

</pre>
<p>Nginx nam odgovara da je pokrenut. Kako bi se i zbilja uvjerili u to jednostavno otvorimo browser te navigiramo na 
</p>
<pre>
http://localhost/
</pre>
<p>tu bi nas trebao dočekati slijedeći prizor,
</p>
<div class="center"><div class="floatnone"><a href="http://security.foi.hr/wiki/index.php/Datoteka:Welcome_to_nginx.png" class="image"><img alt="Welcome to nginx.png" src="../images/8/81/Welcome_to_nginx.png" width="388" height="68" /></a></div></div>
<p>što bi značilo da je nginx uspješno instaliran i pokrenut na našem računalu. 
Dokument koji nam se prikazuje je defaultni html dokument za nginx servere. Taj dokument se nakon instalacije nalazi na slijedećoj putanji.
</p>
<pre>
 /usr/share/nginx/www
</pre>
<p>To je defaultna putanja s koje nginx poslužuje dokumente te se nakon instalacije u tom direktoriju nalaze samo datoteke
</p>
<pre>
50x.html index.html
</pre>
<p>Još jedna stvar koju možemo napraviti je postaviti da se nginx pokreće skupa s računalom, tj. da ga ne moramo svaki put ručno pokretati.
</p>
<pre>
sudo update-rc.d nginx defaults
</pre>
<p>Ukoliko je to već automatski postavljeno, naredba nam odgovara da je nginx već postavljen da se pokreće na startupu.
</p>
<pre>
System start/stop links for /etc/init.d/nginx already exist.
</pre>
<h2> <span class="mw-headline" id="Konfiguracija_PHP-a_na_nginxu"> Konfiguracija PHP-a na nginxu </span></h2>
<p>Izvor: <a href="http://en.wikipedia.org/wiki/Common_Gateway_Interface" class="external autonumber" rel="nofollow">[9]</a> <a href="http://www.fastcgi.com/drupal/" class="external autonumber" rel="nofollow">[10]</a> <a href="http://en.wikipedia.org/wiki/FastCGI" class="external autonumber" rel="nofollow">[11]</a>
</p><p>Nakon instalacije nginxa smo u mogućnosti samo posluživati html datoteke te na taj način imati web stranice koje bi se sastojale samo od html dokumenata. Međutim, u većini slučajeva nam html i statičke web stranice nisu dovoljni te bi htjeli iskoristiti i neke programske jezike da kreiramo dinamičke web aplikacije. Jedan od najpoznatijih i najviše korištenih programskih jezika za kreiranje web aplikacija je zasigurno PHP. Konfiguracija PHP-a na nginx-u zahtjeva određene promjene defaultnih postavki kao i instalaciju dodatnog softwarea. 
</p>
<h3> <span class="mw-headline" id="CGI_i_FastCGI"> CGI i FastCGI </span></h3>
<p>Kratica CGI označava Common Gateway Interface, sučelje  koje specificira način prijenosa informacija između CGI programa i web servera. Pod CGI programom smatramo svaki program koji je dizajniran na način da prihvaća i vraća podatke prema CGI specifikacijama. Takav program može biti napisan u bilo kojem programskom jeziku kao npr. C, Perl, Java i sl.
Korištenje CGI programa je jedan od najkorištenijih načina dinamičke komunikacije web servera i korisnika. HTML stranice koje imaju web forme  u većini slučajeva komuniciraju s CGI programima koji obrađuju proslijeđene podatke. Međutim, CGI ima nekoliko nedostataka. Svakim zahtjevom prema web serveru i pozivanjem nove komande kreira se novi proces na serveru. Pokretanje procesa može biti vremenski i memorijski zahtjevno pogotovo u slučajevima kada program (skripta) još treba biti kompajliran ili interpretiran. Ukoliko se poveća broj zahtjeva, web server bi mogao biti preplavljen njima i moglo bi doći do pada sustava što nam svakako nije u cilju. Jedan od načina ublažavanja ovog problema je korištenje tzv. FastCGI-a. 
FastCGI je, kao što sam naziv i kaže, implementacija CGI-a koja je - brža. FastCGI uključuje određene dodatne funkcionalnosti koje CGI nema. Neke od osnovnih osobina FastCGI-ja su:
</p>
<ul><li> neovisan je o programskom jeziku
</li><li> kao i CGi, FastCGI pokreće aplikacije u procesima koji su izolirani od jezgre web servera. To osigurava veću sigurnost web servera.
</li><li> umjesto kreiranja novog procesa za svaki zahtjev prema web serveru, FastCGI koristi perzistentne procese za rukovanje nizom zahtjeva. Znači da će jedan proces obavljati više zahtjeva, a neće se za svaki zahtjev stvarati novi proces. Na taj način se štedi na vremenu ali i memoriji. Bitno je napomenuti da se ti procesi obavljaju na FastCGI serveru, a ne web serveru. Dakle, pokretanje i odvijanje programa (skripti) se odvija na FastCGI serveru.
</li></ul>
<h3> <span class="mw-headline" id="Instalacija_i_pode.C5.A1avanje_PHP-a"> Instalacija i podešavanje PHP-a </span></h3>
<p>Upravo iz tog razloga, te kako bi uspješno postavili i konfigurirali PHP na nginx, koristiti ćemo PHP-FPM (PHP FastCGI Process Manager). To je jedna od PHP FastCGI implementacija i njena instalacija na ubuntu sustavu je jednostavna:
</p>
<pre>
sudo apt-get install php5-fpm
</pre>
<p>PHP-FPM je daemon proces koji pokreće FastCGI server na portu 9000. 
Nakon što smo uspješno instalirali i pokrenuli FastCGI server, potrebno je dodati virtualni host. Za ovaj primjer ćemo pokrenuti jednog na lokalnom računalu, tj. na localhost-u. Podešavanje virtualnih hostova se obavlja na slijedećoj putanji:
</p>
<pre>
etc/nginx/sites-available/
</pre>
<p>U tom direktoriju se nalazi datoteka
</p>
<pre>
default
</pre>
<p>koja u sebi sadrži osnovnu konfiguraciju virtualnih hostova. Ta datoteka izgleda ovako (direktive objašnjene u komentarima u kodu):
</p>
<pre>
# You may add here your
# server {
#	...
# }
# statements for each of your virtual hosts to this file

##
# You should look at the following URL's in order to grasp a solid understanding
# of Nginx configuration files in order to fully unleash the power of Nginx.
# http://wiki.nginx.org/Pitfalls
# http://wiki.nginx.org/QuickStart
# http://wiki.nginx.org/Configuration
#
# Generally, you will want to move this file somewhere, and start with a clean
# file but keep this around for reference. Or just disable in sites-enabled.
#
# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
##

#definicija virtualnog hosta (servera) se radi unutar server namespace-a. Unutar svakog namespace-a se nalaze direktive. Direktive su uglavnom u obliku: naziv vrijednost [vrijednost2, vrijednost3];
Objašnjenje većine direktiva će biti učinjeno kroz komentare u kodu.
server {
        #direktive za postavljanje porta na kojemu će server osluškivati zahtjeve
        #postoji direktiva za IPv4 kao i za IPv6
	#listen   80; ## listen for ipv4; this line is default and implied
	#listen   [::]:80 default ipv6only=on; ## listen for ipv6
        
        # postavljanje foldera u kojem se nalazi sadržaj kojem klijenti mogu pristupati
	root /usr/share/nginx/www;

        # postavlja defaultni file koji će biti poslužen na zahtjev ukoliko se zahtjevom zatraži folder
        # može imati više datoteka. Ukoliko prva nije dostupna, server će pokušati pronaći drugu.
	index index.html index.htm;

	# postavljanje naziva servera. Način na koji ova direktiva radi je slijedeći:
        # nakon što se dobije HTTP zahtjev na serveru, pregledava se host header u zahtjevu.
        # zatim se dolazi do ove datoteke i pregledava se svaki server {} namespace. Kao odgovor se vraća prvi pronađeni 
        # server (host). Na taj način i rade virtualni hostovi.
	server_name localhost;
        
        # omogućava postavljanje različitih konfiguracija ovisno o URL-u koji je poslan kao zahtjev
        # za pregled URL-a može se koristiti regex ili obični stringovi
        # primjer konfiguracije koja se obavlja nakon poziva linka u obliku
        # http://localhost/file.html
	location / {
		# First attempt to serve request as file, then
		# as directory, then fall back to index.html
		try_files $uri $uri/ /index.html;
		# Uncomment to enable naxsi on this location
		# include /etc/nginx/naxsi.rules
	}

        # primjer konfiguracije koja se obavlja nakon poziva linka u obliku
        # http://localhost/doc/file.html
	location /doc/ {
		alias /usr/share/doc/;
		autoindex on;
		allow 127.0.0.1;
		deny all;
	}
	# Samo za nginx-naxsi (Nginx Anti Xss &amp; Sql Injection)
        # To je third party module za nginx koji provjerava dolazeće linkove u potrazi za mogućim 
        # XSS ili SQL injection napadima. Ukoliko pronađe dijelove URL-a koji to ne bi smjeli biti ( '&lt;', '|' ili 'drop')
        # ovdje se može definirati što bi se trebalo vratiti korisniku
	#location /RequestDenied {
		# For example, return an error code
		#return 418;
	#}
        # ova direktiva definira koja stranica će se prikazati korisniku ukoliko dođe do greške
	#error_page 404 /404.html;
	#error_page 500 502 503 504 /50x.html;

        # definira se lokacija za stranicu 50x.html. Ona se defaultno nalazi u www/ folderu i služi za prikaz
        # problema koji se dogodio prilikom obavljanja zahtjeva
        # ovm direktivom se definira gdje se nalazi ta stranica
	#location = /50x.html {
	#	root /usr/share/nginx/www;
	#}
       
	# definiranje PHP postavki, tj. načina na koji će se pretraživati .php datoteke
	
        
        
        
	#location ~ \.php$ {
        #       # definira se izgled php datoteka iz url-a uz pomoć regexa
	#	fastcgi_split_path_info ^(.+\.php)(/.+)$;

	#	# osim toga, potrebno je definirati i adresu FastCGI servera te broj porta na kojemu on očekuje zahtjeve
	#	fastcgi_pass 127.0.0.1:9000;

	#	# po defaultu je odabrana adresa i broj porta FastCGI-ja međutim moguće je i ručno postaviti da 
        #       # se koristi i unix socket. Korištenje unix socketa je nešto brže jer se ne koristi TCP overhead.
	#	fastcgi_pass unix:/var/run/php5-fpm.sock;

        #       # definira se početna stranica 
	#	fastcgi_index index.php;

	#	include fastcgi_params;
	#}


	# onemogućava se pristu .htaccess fajlovima
	#location ~ /\.ht {
	#	deny all;
	#}
}



# primjer još jednog virtualnog hosta
#server {
#       broj porta na kojemu se osluškuje
#	listen 8000;

#       host
#	listen somename:8080;

#       naziv servera i njegov alias
#	server_name somename alias another.alias;

#       definira root dokument za prikaz
#	root html;

#       definira početne stranice koje se poslužuju u slučaju da zahtjev nema naziv dokumenta kojeg traži
#	index index.html index.htm;

#       #definiranje lokacije
#	location / {
#		try_files $uri $uri/ /index.html;
#	}
#}


# HTTPS server
# primjer definicije HTTPS servera
#server {
#	listen 443;
#	server_name localhost;
#
#	root html;
#	index index.html index.htm;

#       # korištenje ssl-a
#	ssl on;

#       # definiranje dokumenta koji predstavlja certifikat
#	ssl_certificate cert.pem;

#       # definiranje dokumenta koji predstavlja ključ certifikata
#	ssl_certificate_key cert.key;

#       #definiranje timeouta za sesiju na web stranici
#	ssl_session_timeout 5m;
#       # definiranje verzija SSL i TLS protokola koje se koriste
#	ssl_protocols SSLv3 TLSv1;

#       # definiranje algoritama koji su omogućeni za autentikaciju i sl.
#	ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv3:+EXP;

#       # definira da su algoritmi (cipher_suite) koji se nalazi na serveruispred onih definiranih na klijentskoj strani
#	ssl_prefer_server_ciphers on;

#       #definiranje lokacije
#	location / {
#		try_files $uri $uri/ /index.html;
#	}
#}
</pre>
<p>Ova datoteka služi za konfiguriranje virtualnih hostova. Novi hostovi se dodaju, kao što je to opisano u komentaru unutar odjeljka
</p>
<pre>
server {
  ...
  }
</pre>
<p>inače, ova datoteka je jako dobro dokumentirana i lako je prepoznati što koja linija koda radi te kako ju je moguće konfigurirati da radi ono što želimo. Također, dani su nam i neki linkovi koji prikazuju neke standardne konfiguracije koje su dobre za početnike koji se ne žele malo više pozabaviti konfiguracijom. Trenutna konfiguracija nam omogućuje da samo poslužujemo standardni html, tj. početnu nginx stranicu koju smo vidjeli ranije. Za dinamičko posluživanje stranica uz pomoć PHP-a potrebno je napraviti određene promjene u ovoj konfiguraciji. Promjene su slijedeće: kao prvo, potrebno je odkomentirati slijedeće linije:
</p>
<pre>
listen   80; ## listen for ipv4; this line is default and implied
listen   [::]:80 default ipv6only=on; ## listen for ipv6
</pre>
<p>kojima se nginx postavlja da osluškuje na portu 80 (HTTP port) i to za IPv4 i Ipv6.
Nakon toga mijenjamo index polje kojemu dodajemo jos jedan oblik indeksne datoteke
</p>
<pre>
index.php
</pre>
<p>dok root ostavljamo isti. Kao root je definiran folder u kojem se nalazi sadržaj kojem klijenti mogu pristupati. Lokacija je:
</p>
<pre>
root /usr/share/nginx/www;
</pre>
<p>I naposlijetku najvažniji dio, konfiguriranje PHP-a. Nginx u svojem config fajlu za virtualne hostove ima direktivu koja upravlja php instalacijom. Nju jepotrebno promijeniti na slijedeći način kako bismo omogućili rad s PHP-om na našoj web stranici (na nginx-u):
</p>
<pre>
# pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
location ~ \.php$ {
   fastcgi_split_path_info ^(.+\.php)(/.+)$;
   # NOTE: You should have &quot;cgi.fix_pathinfo = 0;&quot; in php.ini
   # With php5-cgi alone:
   fastcgi_pass 127.0.0.1:9000;
   fastcgi_index index.php;
   include fastcgi_params;
}
</pre>
<p>Omogućili smo pokretanje PHP skripti te smo stavili putanju do FastCGI servera. Kao što je ranije napomenuto, taj server radi kao daemon proces na lokalnom hostu na portu 9000. Upravo tu konfiguraciju smo naveli i ovdje.
Nakon što je sve konfigurirano, potrebno je restartati nginx server. To se radi slijedećom naredbom:
</p>
<pre>
sudo ./etc/init.d/nginx reload
Reloading nginx configuration: nginx.
</pre>
<p>U root folderu koji smo naveli ranije sada je moguće kreirati PHP skripte i na taj način razvijati dinamičke web stranice. Kao primjer napraviti ćemo jednostavnu PHP skriptu koja pokazuje informacije o PHP-u koji je instaliran na računalu. Skripta je slijedeća:
</p>
<pre>
&lt;?php
 phpinfo();
?&gt;
</pre>
<p>Pokretanjem stranice na lokalnom hostu localhost/index.php učitava nam se standardni ekran sa informacijama o php verziji  instaliranoj na računalu. Također, u polju Server API možemo vidjeti da se aplikacija izvodi uz pomoć FPM/FastCGI kojeg smo installirali ranije. 
</p>
<div class="thumb tright"><div class="thumbinner" style="width:182px;"><a href="http://security.foi.hr/wiki/index.php/Datoteka:Phpinfo.png" class="image"><img alt="Phpinfo.png" src="../images/thumb/d/db/Phpinfo.png/180px-Phpinfo.png" width="180" height="214" class="thumbimage" /></a>  <div class="thumbcaption"><div class="magnify"><a href="http://security.foi.hr/wiki/index.php/Datoteka:Phpinfo.png" class="internal" title="Povećaj"><img src="../skins/common/images/magnify-clip.png" width="15" height="11" alt="" /></a></div></div></div></div>
<p><br />
</p>
<h2> <span class="mw-headline" id="Sigurnost_.28najbolja_praksa.29"> Sigurnost (najbolja praksa) </span></h2>
<p><a href="http://www.cyberciti.biz/tips/linux-unix-bsd-nginx-webserver-security.html" class="external autonumber" rel="nofollow">[12]</a>
</p>
<h3> <span class="mw-headline" id="Config_fileovi_i_portovi"> Config fileovi i portovi </span></h3>
<ul><li> /usr/local/nginx/conf/ - konfiguracijski direktorij nginx servera u koje se nalazu konfiguracijska datoteka pod nazivom nginx.conf
</li><li> /usr/local/nginx/html/ - lokacija na kojoj se nalaze dokumenti
</li><li> /usr/local/nginx/logs/ - lokacija na kojoj se nalazi log dokument
</li><li> HTTP port: TCP 80
</li><li> HTTPS port: TCP 443
</li></ul>
<p><br />
Testiranje promjena u konfiguraciji nginx-a se provodi na sljedeći način:
</p>
<pre>
# /usr/local/nginx/sbin/nginx -t
</pre>
<p>Primjer izvođenja:
</p>
<pre>
the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok
configuration file /usr/local/nginx/conf/nginx.conf test is successful
</pre>
<p>Za učitavanje konfiguracijskih promjena koristimo:
</p>
<pre>
# /usr/local/nginx/sbin/nginx -s reload
</pre>
<p>Za zaustavljanje servera:
</p>
<pre>
# /usr/local/nginx/sbin/nginx -s stop
</pre>
<p><br />
</p>
<h3> <span class="mw-headline" id="SELinux"> SELinux </span></h3>
<p>Security-Enhanced Linux (SELinux) je dodatak za Linux kernel koji pruža mehanizme za podršku za sigurnosne politike kontrole pristupa i time sprječavaju mnoge napade na sustav. 
</p><p>Boolean zaključavanje
Pokrenite getsebool –a naredbu i zaključajte sustav:
</p>
<pre>
getsebool -a | less
getsebool -a | grep off
getsebool -a | grep o
</pre>
<p>Da bi osigurali sustav, pogledajte postavke koje su postavljene na 'on' te ih promijenite u 'off' ako vam nisu potrebne koristeći getsebool naredbu. Pravilnim postavljanjem boolean vrijednosti SELinux-a osigurava se održavanje funkcionalnosti i zaštite.
</p><p><br />
</p>
<h3> <span class="mw-headline" id="Minimalne_privilegije_preko_Mount_opcija"> Minimalne privilegije preko Mount opcija </span></h3>
<p>Posluživanje svih web stranica / html / php fileova preko odvojenih particija. Na primjer, kreirajte particiju pod /dev/sda5 i mountajte /nginx sa sljedećim dozvolama: noexec, nodev, nosetuid. Ovako bi mogao izgledati /etc/fstab za mountanje /nginx-a:
</p>
<pre>
LABEL=/nginx     /nginx          ext3   defaults,nosuid,noexec,nodev 1 2
</pre>
<p>(Potrebno je kreirati novu particiju s fdisk i mkfs.ext3 naredbama)
</p>
<h3> <span class="mw-headline" id="Linux_.2Fetx.2Fsysctl.conf_Hardening"> Linux /etx/sysctl.conf Hardening </span></h3>
<p>Kontrola i konfiguracija Linux kernela i mrežnih postavki se može podesiti pomoću /etc/sysctl.conf filea.
</p>
<pre>
# Avoid a smurf attack
net.ipv4.icmp_echo_ignore_broadcasts = 1
 
# Turn on protection for bad icmp error messages
net.ipv4.icmp_ignore_bogus_error_responses = 1
 
# Turn on syncookies for SYN flood attack protection
net.ipv4.tcp_syncookies = 1
 
# Turn on and log spoofed, source routed, and redirect packets
net.ipv4.conf.all.log_martians = 1
net.ipv4.conf.default.log_martians = 1
 
# No source routed packets here
net.ipv4.conf.all.accept_source_route = 0
net.ipv4.conf.default.accept_source_route = 0
 
# Turn on reverse path filtering
net.ipv4.conf.all.rp_filter = 1
net.ipv4.conf.default.rp_filter = 1
 
# Make sure no one can alter the routing tables
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.default.accept_redirects = 0
net.ipv4.conf.all.secure_redirects = 0
net.ipv4.conf.default.secure_redirects = 0
 
# Don't act as a router
net.ipv4.ip_forward = 0
net.ipv4.conf.all.send_redirects = 0
net.ipv4.conf.default.send_redirects = 0
 
 
# Turn on execshild
kernel.exec-shield = 1
kernel.randomize_va_space = 1
 
# Tuen IPv6
net.ipv6.conf.default.router_solicitations = 0
net.ipv6.conf.default.accept_ra_rtr_pref = 0
net.ipv6.conf.default.accept_ra_pinfo = 0
net.ipv6.conf.default.accept_ra_defrtr = 0
net.ipv6.conf.default.autoconf = 0
net.ipv6.conf.default.dad_transmits = 0
net.ipv6.conf.default.max_addresses = 1
 
# Optimization for port usefor LBs
# Increase system file descriptor limit
fs.file-max = 65535
 
# Allow for more PIDs (to reduce rollover problems); may break some programs 32768
kernel.pid_max = 65536
 
# Increase system IP port limits
net.ipv4.ip_local_port_range = 2000 65000
 
# Increase TCP max buffer size setable using setsockopt()
net.ipv4.tcp_rmem = 4096 87380 8388608
net.ipv4.tcp_wmem = 4096 87380 8388608
 
# Increase Linux auto tuning TCP buffer limits
# min, default, and max number of bytes to use
# set max to at least 4MB, or higher if you use very high BDP paths
# Tcp Windows etc
net.core.rmem_max = 8388608
net.core.wmem_max = 8388608
net.core.netdev_max_backlog = 5000
net.ipv4.tcp_window_scaling = 1
</pre>
<p><br />
</p>
<h3> <span class="mw-headline" id="Micanje_svih_ne.C5.BEeljenih_nginx_modula"> Micanje svih neželjenih nginx modula </span></h3>
<p>Želimo minimalizirati broj modula koji su kompilirani direktno u nginx binary. Smanjivanjem mogućnosti koje su dozvoljene na web serveru smanjujemo i rizik. Možemo konfigurirati i instalirati nginx koristeći samo potrebne module. Ukoliko želimo onemogućiti SSI i autoindx module, upisati ćemo sljedeće:
</p>
<pre>
# ./configure --without-http_autoindex_module --without-http_ssi_module
# make
# make install
</pre>
<p>Sljedeća naredba omogućava pregled modula koji mogu biti uključeni/isključeni prilikom kompiliranja nginx-a:
</p>
<pre>
# ./configure --help | less
</pre>
<p>Onemogućite nginx module koji vam nisu potrebni.
</p><p>(Opcionalno) promjena nginx Version Header-a
Uredite src/http/ngx_http_header_filter_module.c:
</p>
<pre>
# vi +48 src/http/ngx_http_header_filter_module.c
</pre>
<p>Pronađite linije:
</p>
<pre>
static char ngx_http_server_string[] = &quot;Server: nginx&quot; CRLF;
static char ngx_http_server_full_string[] = &quot;Server: &quot; NGINX_VER CRLF;
</pre>
<p>te ih proizvoljno promijenite, npr:
</p>
<pre>
static char ngx_http_server_string[] = &quot;Server: Ninja Web Server&quot; CRLF;
static char ngx_http_server_full_string[] = &quot;Server: Ninja Web Server&quot; CRLF;
</pre>
<p>Spremite i zatvorite file, te nakon toga kompilirajte server. Dodajte sljedeće u nginx.conf kako bi ugasili prikaz nginx verzije na svima automatski generiranim error stranicama.
</p>
<pre>
server_tokens off
</pre>
<p><br />
</p>
<h3> <span class="mw-headline" id="Instalacija_SELinux_Policy_za_za.C5.A1titu_nginx_webservera"> Instalacija SELinux Policy za zaštitu nginx webservera </span></h3>
<p>SELinux s početnim postavkama neće zaštititi nginx web server, no moguće je instalirati i kompilirati zaštitu na sljedeći način:
Najprije instalirajte:
</p>
<pre>
# yum -y install selinux-policy-targeted selinux-policy-devel
</pre>
<p>Skinite ciljane SELinux politike za zaštitu nginx webservera na Linux server s početne stranice projekta:
</p>
<pre>
# cd /opt
# wget 'http://downloads.sourceforge.net/project/selinuxnginx/se-ngix_1_0_10.tar.gz?use_mirror=nchc'
</pre>
<p>Otpakirajte skinuti file:
</p>
<pre>
# tar -zxvf se-ngix_1_0_10.tar.gz
</pre>
<p>Kompilirajte isti:
</p>
<pre>
# cd se-ngix_1_0_10/nginx
# make
</pre>
<p> 
Primjer outputa:
</p>
<pre>
Compiling targeted nginx module
/usr/bin/checkmodule:  loading policy configuration from tmp/nginx.tmp
/usr/bin/checkmodule:  policy configuration loaded
/usr/bin/checkmodule:  writing binary representation (version 6) to tmp/nginx.mod
Creating targeted nginx.pp policy package
rm tmp/nginx.mod.fc tmp/nginx.mod
</pre>
<p>Instalirajte kreirani nginx.pp SELinux modul:
</p>
<pre>
# /usr/sbin/semodule -i nginx.pp
</pre>
<p><br />
</p>
<h3> <span class="mw-headline" id="Restriktivan_firewall_temeljen_na_iptables-ima"> Restriktivan firewall temeljen na iptables-ima </span></h3>
<p>Sljedeća firewall skripta blokira sve i dopušta samo:
</p>
<ul><li> Dolazne HTTP (TCP port 80) zahtjeve
</li><li> Dolazne ICMP ping zahtjeve
</li><li> Odlazne ntp (port 123) zahtjeve
</li><li> Odlazne smtp (TCP port 25) zahtjeve
</li></ul>
<pre>
#!/bin/bash
IPT=&quot;/sbin/iptables&quot;
 
#### IPS ######
# Get server public ip 
SERVER_IP=$(ifconfig eth0 | grep 'inet addr:' | awk -F'inet addr:' '{ print $2}' | awk '{ print $1}')
LB1_IP=&quot;204.54.1.1&quot;
LB2_IP=&quot;204.54.1.2&quot;
 
# Do some smart logic so that we can use damm script on LB2 too
OTHER_LB=&quot;&quot;
SERVER_IP=&quot;&quot;
[[ &quot;$SERVER_IP&quot; == &quot;$LB1_IP&quot; ]] &amp;&amp; OTHER_LB=&quot;$LB2_IP&quot; || OTHER_LB=&quot;$LB1_IP&quot;
[[ &quot;$OTHER_LB&quot; == &quot;$LB2_IP&quot; ]] &amp;&amp; OPP_LB=&quot;$LB1_IP&quot; || OPP_LB=&quot;$LB2_IP&quot;
 
### IPs ###
PUB_SSH_ONLY=&quot;122.xx.yy.zz/29&quot;
 
#### FILES #####
BLOCKED_IP_TDB=/root/.fw/blocked.ip.txt
SPOOFIP=&quot;127.0.0.0/8 192.168.0.0/16 172.16.0.0/12 10.0.0.0/8 169.254.0.0/16 0.0.0.0/8 240.0.0.0/4 255.255.255.255/32 168.254.0.0/16 224.0.0.0/4 240.0.0.0/5 248.0.0.0/5 192.0.2.0/24&quot;
BADIPS=$( [[ -f ${BLOCKED_IP_TDB} ]] &amp;&amp; egrep -v &quot;^#|^$&quot; ${BLOCKED_IP_TDB})
 
### Interfaces ###
PUB_IF=&quot;eth0&quot;   # public interface
LO_IF=&quot;lo&quot;      # loopback
VPN_IF=&quot;eth1&quot;   # vpn / private net
 
### start firewall ###
echo &quot;Setting LB1 $(hostname) Firewall...&quot;
 
# DROP and close everything 
$IPT -P INPUT DROP
$IPT -P OUTPUT DROP
$IPT -P FORWARD DROP
 
# Unlimited lo access
$IPT -A INPUT -i ${LO_IF} -j ACCEPT
$IPT -A OUTPUT -o ${LO_IF} -j ACCEPT
 
# Unlimited vpn / pnet access
$IPT -A INPUT -i ${VPN_IF} -j ACCEPT
$IPT -A OUTPUT -o ${VPN_IF} -j ACCEPT
 
# Drop sync
$IPT -A INPUT -i ${PUB_IF} -p tcp&#160;! --syn -m state --state NEW -j DROP
 
# Drop Fragments
$IPT -A INPUT -i ${PUB_IF} -f -j DROP
 
$IPT  -A INPUT -i ${PUB_IF} -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP
$IPT  -A INPUT -i ${PUB_IF} -p tcp --tcp-flags ALL ALL -j DROP
 
# Drop NULL packets
$IPT  -A INPUT -i ${PUB_IF} -p tcp --tcp-flags ALL NONE -m limit --limit 5/m --limit-burst 7 -j LOG --log-prefix &quot; NULL Packets &quot;
$IPT  -A INPUT -i ${PUB_IF} -p tcp --tcp-flags ALL NONE -j DROP
 
$IPT  -A INPUT -i ${PUB_IF} -p tcp --tcp-flags SYN,RST SYN,RST -j DROP
 
# Drop XMAS
$IPT  -A INPUT -i ${PUB_IF} -p tcp --tcp-flags SYN,FIN SYN,FIN -m limit --limit 5/m --limit-burst 7 -j LOG --log-prefix &quot; XMAS Packets &quot;
$IPT  -A INPUT -i ${PUB_IF} -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP
 
# Drop FIN packet scans
$IPT  -A INPUT -i ${PUB_IF} -p tcp --tcp-flags FIN,ACK FIN -m limit --limit 5/m --limit-burst 7 -j LOG --log-prefix &quot; Fin Packets Scan &quot;
$IPT  -A INPUT -i ${PUB_IF} -p tcp --tcp-flags FIN,ACK FIN -j DROP
 
$IPT  -A INPUT -i ${PUB_IF} -p tcp --tcp-flags ALL SYN,RST,ACK,FIN,URG -j DROP
 
# Log and get rid of broadcast / multicast and invalid 
$IPT  -A INPUT -i ${PUB_IF} -m pkttype --pkt-type broadcast -j LOG --log-prefix &quot; Broadcast &quot;
$IPT  -A INPUT -i ${PUB_IF} -m pkttype --pkt-type broadcast -j DROP
 
$IPT  -A INPUT -i ${PUB_IF} -m pkttype --pkt-type multicast -j LOG --log-prefix &quot; Multicast &quot;
$IPT  -A INPUT -i ${PUB_IF} -m pkttype --pkt-type multicast -j DROP
 
$IPT  -A INPUT -i ${PUB_IF} -m state --state INVALID -j LOG --log-prefix &quot; Invalid &quot;
$IPT  -A INPUT -i ${PUB_IF} -m state --state INVALID -j DROP
 
# Log and block spoofed ips
$IPT -N spooflist
for ipblock in $SPOOFIP
do
         $IPT -A spooflist -i ${PUB_IF} -s $ipblock -j LOG --log-prefix &quot; SPOOF List Block &quot;
         $IPT -A spooflist -i ${PUB_IF} -s $ipblock -j DROP
done
$IPT -I INPUT -j spooflist
$IPT -I OUTPUT -j spooflist
$IPT -I FORWARD -j spooflist
 
# Allow ssh only from selected public ips
for ip in ${PUB_SSH_ONLY}
do
        $IPT -A INPUT -i ${PUB_IF} -s ${ip} -p tcp -d ${SERVER_IP} --destination-port 22 -j ACCEPT
        $IPT -A OUTPUT -o ${PUB_IF} -d ${ip} -p tcp -s ${SERVER_IP} --sport 22 -j ACCEPT
done
 
# allow incoming ICMP ping pong stuff
$IPT -A INPUT -i ${PUB_IF} -p icmp --icmp-type 8 -s 0/0 -m state --state NEW,ESTABLISHED,RELATED -m limit --limit 30/sec  -j ACCEPT
$IPT -A OUTPUT -o ${PUB_IF} -p icmp --icmp-type 0 -d 0/0 -m state --state ESTABLISHED,RELATED -j ACCEPT
 
# allow incoming HTTP port 80
$IPT -A INPUT -i ${PUB_IF} -p tcp -s 0/0 --sport 1024:65535 --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT
$IPT -A OUTPUT -o ${PUB_IF} -p tcp --sport 80 -d 0/0 --dport 1024:65535 -m state --state ESTABLISHED -j ACCEPT
 
 
# allow outgoing ntp 
$IPT -A OUTPUT -o ${PUB_IF} -p udp --dport 123 -m state --state NEW,ESTABLISHED -j ACCEPT
$IPT -A INPUT -i ${PUB_IF} -p udp --sport 123 -m state --state ESTABLISHED -j ACCEPT
 
# allow outgoing smtp
$IPT -A OUTPUT -o ${PUB_IF} -p tcp --dport 25 -m state --state NEW,ESTABLISHED -j ACCEPT
$IPT -A INPUT -i ${PUB_IF} -p tcp --sport 25 -m state --state ESTABLISHED -j ACCEPT
 
### add your other rules here ####
 
#######################
# drop and log everything else
$IPT -A INPUT -m limit --limit 5/m --limit-burst 7 -j LOG --log-prefix &quot; DEFAULT DROP &quot;
$IPT -A INPUT -j DROP
 
exit 0
</pre>
<p><br />
</p>
<h3> <span class="mw-headline" id="Kontrola_Buffer_Overflow_napada"> Kontrola Buffer Overflow napada </span></h3>
<p>Uredite nginx.conf i postavite ograničenje veličine buffera za sve korisnike:
</p>
<pre>
# vi /usr/local/nginx/conf/nginx.conf
</pre>
<p> 
Postavite sljedeće:
</p>
<pre>
## Start: Size Limits &amp; Buffer Overflows ##
  client_body_buffer_size  1K;
  client_header_buffer_size 1k;
  client_max_body_size 1k;
  large_client_header_buffers 2 1k;
## END: Size Limits &amp; Buffer Overflows ##
</pre>
<p>Također je potrebo kontrolirati timeout za poboljšanje performansi servera:
</p>
<pre>
## Start: Timeouts ##
  client_body_timeout   10;
  client_header_timeout 10;
  keepalive_timeout     5 5;
  send_timeout          10;
## End: Timeouts ##
</pre>
<p><br />
</p>
<h3> <span class="mw-headline" id="Kontrola_istovremenih_konekcija"> Kontrola istovremenih konekcija </span></h3>
<p>Koristiti ćemo NginxHttpLimitZone modul za ograničavanje broja istovremenih konekcija za određenu sesiju ili u posebnom slučaju s jedne IP adrese. Uredite nginx.conf:
</p>
<pre>
### Directive describes the zone, in which the session states are stored i.e. store in slimits. ###
### 1m can handle 32000 sessions with 32 bytes/session, set to 5m x 32000 session ###
       limit_zone slimits $binary_remote_addr 5m; 
### Control maximum number of simultaneous connections for one session i.e. ###
### restricts the amount of connections from a single ip address ###
        limit_conn slimits 5;
</pre>
<p>Gore navedena ograničenja će limitirati udaljene klijente na ne više od pet konkurentnih „otvorenih“ konekcija po IP adresi.
</p><p><br />
</p>
<h3> <span class="mw-headline" id="Dopu.C5.A1tanje_pristupa_samo_vlastitoj_domeni"> Dopuštanje pristupa samo vlastitoj domeni </span></h3>
<p>Ukoliko bot skenira sve domene na nekom serveru, potrebno se je zaštiti. Moramo omogućiti samo konfigurirane virtualne domenske ili reverse proxy zahtjeve. Ne želimo prikazati zahtjeve koristeći IP adresu:
</p>
<pre>
## Only requests to our Host are allowed i.e. nixcraft.in, images.nixcraft.in and www.nixcraft.in
      if ($host&#160;!~ ^(nixcraft.in|www.nixcraft.in|images.nixcraft.in)$ ) {
         return 444;
      }
##
</pre>
<p><br />
</p>
<h3> <span class="mw-headline" id="Ograni.C4.8Denje_dostupnih_metoda"> Ograničenje dostupnih metoda </span></h3>
<p>GET i POST su najpoznatije metode na Internetu. Ukoliko web server ne zahtjeva implementaciju svih ostalih dostupnih metoda, one bi trebale biti onemogućene. Sljedeći blok će filtrirati i omogućiti samo GET, HEAD i POST metode:
</p>
<pre>
## Only allow these request methods ##
     if ($request_method&#160;!~ ^(GET|HEAD|POST)$ )  
         return 444;
     }
## Do not accept DELETE, SEARCH and other methods ##
</pre>
<p> 
</p>
<h3> <span class="mw-headline" id="Odbijanje_pojedinih_.E2.80.9EUser-Agent.E2.80.9C-a"> Odbijanje pojedinih „User-Agent“-a </span></h3>
<p>Blokiranje user-agenata kao što su skeneri, botovi i spameri koji bi iskorištavali server:
</p>
<pre>
## Block download agents ##
     if ($http_user_agent ~* LWP::Simple|BBBike|wget) {
            return 403;
     }
##
</pre>
<p>Blokiranje msnbot i scrapbot robota:
</p>
<pre>
## Block some robots ##
     if ($http_user_agent ~* msnbot|scrapbot)  
            return 403;
     }
##
</pre>
<p><br />
</p>
<h3> <span class="mw-headline" id="Blokiranje_upu.C4.87enog_spama"> Blokiranje upućenog spama </span></h3>
<p>Upućeni spam može biti opasan iz razloga što može narušiti rating web stranice preko web-logova (ukoliko su objavljeni) kao mjesto s kojega se preusmjerava na stranice sa spamom. Blokiranje pristupa spamerima se može realizirati pomoću:
</p>
<pre>
## Deny certain Referers ###
     if ( $http_referer ~* (babes|forsale|girl|jewelry|love|nudit|organic|poker|porn|sex|teen) )
     {
         # return 404;
         return 403;
     }
##
</pre>
<p><br />
</p>
<h3> <span class="mw-headline" id="Zaustavljanje_.E2.80.9EImage_Hotlinking.E2.80.9C-a"> Zaustavljanje „Image Hotlinking“-a </span></h3>
<p>Image ili HTML hotlinking znači da netko postavlja link do vaše stranice, odnosno do jedne od slika i prikazuje je na vlastitoj stranici. Rezultat toga je nepotrebno trošenje bandwitha, te će sadržaj izgledati kao dio otimačeve stranice. Ova tehnika se većinom koristi na forumima i blogovima. Preporuča se blokiranje i zaustavljanje hotlinkanja slika na razini servera.
</p>
<pre>
# Stop deep linking or hot linking
location /images/ {
  valid_referers none blocked www.example.com example.com;
   if ($invalid_referer) {
     return   403;
   }
}
</pre>
<p>Primjer: prepisivanje i prikazivanje slike (link do bannane slike):
</p>
<pre>
valid_referers blocked www.example.com example.com;
 if ($invalid_referer) {
  rewrite ^/images/uploads.*\.(gif|jpg|jpeg|png)$ http://www.examples.com/banned.jpg last
 }
</pre>
<p><br />
</p>
<h3> <span class="mw-headline" id="Restrikcije_direktorija"> Restrikcije direktorija </span></h3>
<p>Moguće je postaviti kontrolu pristupa određenom direktoriju. Svi web direktoriji bi trebali biti konfigurirani na „case-by-case“ bazi, dozvoljavajući pristup samo kada je to potrebno.
 
Ograničenje pristupa po IP adresi
Ograničavanje pristupa direktoriju /docs/directory po ip adresi:
</p>
<pre>
location /docs/ {
  ## block one workstation
  deny    192.168.1.1;
  ## allow anyone in 192.168.1.0/24
  allow   192.168.1.0/24;
  ## drop rest of the world
  deny    all;
}
</pre>
<p>Zaštita direktorija lozinkom
</p><p>Najprije kreiramo file s lozinkom te dodajemo korisnika zvanog sisuser:
</p>
<pre>
# mkdir /usr/local/nginx/conf/.htpasswd/
# htpasswd -c /usr/local/nginx/conf/.htpasswd/passwd sisuser
</pre>
<p>Uređujemo nginx.conf i zaštićujemo potrebne direktorije na sljedeći način:
</p>
<pre>
### Password Protect /personal-images/ and /delta/ directories ###
location ~ /(personal-images/.*|delta/.*) {
  auth_basic  &quot;Restricted&quot;;
  auth_basic_user_file   /usr/local/nginx/conf/.htpasswd/passwd;
}
</pre>
<p>Jednom kada se generira file s lozinkom, naredni korisnici se mogu dodavati naredbom:
</p>
<pre>
# htpasswd -s /usr/local/nginx/conf/.htpasswd/passwd userName
</pre>
<p> 
</p>
<h3> <span class="mw-headline" id="nginx_SSL_konfiguracija"> nginx SSL konfiguracija </span></h3>
<p>HTTP je plain text protokol što ga čini otvorenim za pasivno praćenje, no tu dolazi SSL koji kriptira sadržaj za korisnike.
</p><p>Kreiranje SSL certifikata:
</p>
<pre>
# cd /usr/local/nginx/conf
# openssl genrsa -des3 -out server.key 1024
# openssl req -new -key server.key -out server.csr
# cp server.key server.key.org
# openssl rsa -in server.key.org -out server.key
# openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt
</pre>
<p>Uredite nginx.conf i ažurirajte na sljedeći način:
</p>
<pre>
server {
    server_name example.com;
    listen 443;
    ssl on;
    ssl_certificate /usr/local/nginx/conf/server.crt;
    ssl_certificate_key /usr/local/nginx/conf/server.key;
    access_log /usr/local/nginx/logs/ssl.access.log;
    error_log /usr/local/nginx/logs/ssl.error.log;
}
</pre>
<p>te naposljetku ponovno pokrenite nginx:
</p>
<pre>
# /usr/local/nginx/sbin/nginx -s reload
</pre>
<p>Više o „NginxHttpSslModule“ modulu možete pročitati na: <a href="http://wiki.nginx.org/NginxHttpSslModule" class="external free" rel="nofollow">http://wiki.nginx.org/NginxHttpSslModule</a>
 
</p>
<h3> <span class="mw-headline" id="nginx_i_PHP_sigurnosni_savjeti"> nginx i PHP sigurnosni savjeti </span></h3>
<p>PHP je jedan od poznatijih skriptnih jezika na strani poslužitelja.
</p><p>Editirajte /etc/php.ini:
</p>
<pre>
# Disallow dangerous functions
disable_functions = phpinfo, system, mail, exec 
## Try to limit resources  ##
 
# Maximum execution time of each script, in seconds
max_execution_time = 30
 
# Maximum amount of time each script may spend parsing request data
max_input_time = 60
 
# Maximum amount of memory a script may consume (8MB)
memory_limit = 8M
 
# Maximum size of POST data that PHP will accept.
post_max_size = 8M
 
# Whether to allow HTTP file uploads.
file_uploads = Off
 
# Maximum allowed size for uploaded files.
upload_max_filesize = 2M
 
# Do not expose PHP error messages to external users
display_errors = Off
 
# Turn on safe mode
safe_mode = On
 
# Only allow access to executables in isolated directory
safe_mode_exec_dir = php-required-executables-path
 
# Limit external access to PHP environment
safe_mode_allowed_env_vars = PHP_
 
# Restrict PHP information leakage
expose_php = Off
 
# Log all errors
log_errors = On
 
# Do not register globals for input data
register_globals = Off
 
# Minimize allowable PHP post size
post_max_size = 1K
 
# Ensure PHP redirects appropriately
cgi.force_redirect = 0
 
# Disallow uploading unless necessary
file_uploads = Off
 
# Enable SQL safe mode
sql.safe_mode = On
 
# Avoid Opening remote files
allow_url_fopen = Off
</pre>
<p><br />
</p>
<h3> <span class="mw-headline" id="nginx_u_Chroot_Jail-u_.28kontejneru.29"> nginx u Chroot Jail-u (kontejneru) </span></h3>
<p>Ukoliko je moguće, postavite nginx u chroot jail, time se minimizira šteta kod potencijalnog upada u sustav, na način da se web server izolira na malom dijelu filesystema. Detaljnije upute se nalaze na: <a href="http://www.cyberciti.biz/faq/howto-run-nginx-in-a-chroot-jail/" class="external free" rel="nofollow">http://www.cyberciti.biz/faq/howto-run-nginx-in-a-chroot-jail/</a> . Ako je moguće koristiti FreeBSD jail, XEN, ili OpenVZ virtualizacije koje koriste koncept kontejnera. 
 
</p>
<h3> <span class="mw-headline" id="Ograni.C4.8Davanje_konekcija_po_IP-u_na_razini_firewall-a"> Ograničavanje konekcija po IP-u na razini firewall-a </span></h3>
<p>Web server mora pripaziti na konekcije i ograničiti njihov broj po sekundi, iptables može prigušiti broj krajnjih korisnika prije pristupanja nginx serveru.
</p><p>Linux Iptables
</p><p>Sljedeći primjer prikazuje kako će server dropati dolazne konekcije ukoliko s istog IP-a bude više od 15 pokušaja spajanja na port 80 unutar 60 sekundi:
</p>
<pre>
/sbin/iptables -A INPUT -p tcp --dport 80 -i eth0 -m state --state NEW -m recent --set
/sbin/iptables -A INPUT -p tcp --dport 80 -i eth0 -m state --state NEW -m recent --update --seconds 60  --hitcount 15 -j DROP
service iptables save
</pre>
<p>Sve vrijednosti podesite u ovisnosti o vašim potrebama i prometu, te imajte na umu da preglednik može otvoriti više veza prema vašoj stranici. Primjer Iptables firewall skripte može se naći na&#160;: <a href="http://bash.cyberciti.biz/firewall/linux-iptables-firewall-shell-script-for-standalone-server/" class="external free" rel="nofollow">http://bash.cyberciti.biz/firewall/linux-iptables-firewall-shell-script-for-standalone-server/</a> .
</p><p><br />
</p>
<h3> <span class="mw-headline" id="Konfiguriranje_operacijskog_sustava_kako_bi_.C5.A1titio_web_server"> Konfiguriranje operacijskog sustava kako bi štitio web server </span></h3>
<p>Uključiti SELinux kako je prethodno opisano, postaviti ispravne dozvole na korijen nginx dokumenta. nginx se izvodi kao korisnik imena nginx, no fileovi u korijenskom dokumentu (/nginx ili /usr/local/nginx/html) ne bi trebali biti u posjedu ili pisani od strane tog korisnika. 
</p><p>Za pronalazak fileova s krivim dozvolama, koristi se:
</p>
<pre>
# find /nginx -user nginx
# find /usr/local/nginx/html -user nginx
</pre>
<p>Promijenite vlasništvo filea na root ili nekog drugog korisnika. Tipični skup dozvola za /usr/local/nginx/html/:
</p>
<pre>
# ls -l /usr/local/nginx/html/
</pre>
<p>Primjer outputa:
</p>
<pre>
-rw-r--r-- 1 root root 925 Jan  3 00:50 error4xx.html
-rw-r--r-- 1 root root  52 Jan  3 10:00 error5xx.html
-rw-r--r-- 1 root root 134 Jan  3 00:52 index.html
</pre>
<p>Potrebo je obrisati neželjene backup fileove koje kreira vi ili neki drugi text editor:
</p>
<pre>
# find /nginx -name '.?*' -not -name .ht* -or -name '*~' -or -name '*.bak*' -or -name '*.old*'
# find /usr/local/nginx/html/ -name '.?*' -not -name .ht* -or -name '*~' -or -name '*.bak*' -or -name '*.old*'
</pre>
<p>Dodajte –delete opciju naredbi find za brisanje tih fileova.
</p><p><br />
</p>
<h3> <span class="mw-headline" id="Zabrana_odlaznih_nginx_konekcija"> Zabrana odlaznih nginx konekcija </span></h3>
<p>Crackeri će pokušati skinuti file lokalno na server koristeći alate kao što je wget. Korištenjem iptable-sa moguće je blokirati odlazne konekcije nginx korisnika. ipt_owner modul će pokušati usporediti razne karakteristike kreatora paketa, za lokalno generirane pakete. Ovo vrijedi samo u izlaznom lancu (output chain).
</p><p>U ovom primjeru dozvoliti ćemo korisniku sisuser da ostvari konekciju prema van koristeći port 80:
</p>
<pre>
/sbin/iptables -A OUTPUT -o eth0 -m owner --uid-owner vivek -p tcp --dport 80 -m state --state NEW,ESTABLISHED  -j ACCEPT
</pre>
<p>Dodajte gore navedeno pravilo u iptables shell skriptu. Ne dozvolite nginx web server korisniku da ostvaruje konekcija prema van.
</p><p>PREPORUKA: Pratite logove
Praćenjem log fileova može se doći do informacija koje mogu pomoći pri shvaćanju koji vrsta napada se pokušala izvesti na server i time omogućiti provjeru da li je realizirana određena (potrebna) razina zaštite.
</p>
<pre>
# grep &quot;/login.php??&quot; /usr/local/nginx/logs/access_log
# grep &quot;...etc/passwd&quot; /usr/local/nginx/logs/access_log
# egrep -i &quot;denied|error|warn&quot; /usr/local/nginx/logs/error_log
</pre>
<p>Audit servis omogućava nadgledanje sustava, uključite ga za SELinux evente, autentifikacijske evente, izmjenu datoteka, izmjenu korisničkih računa, itd. Onemogućite sve servise te pratite preporuke s: <a href="http://www.cyberciti.biz/tips/linux-security.html" class="external free" rel="nofollow">http://www.cyberciti.biz/tips/linux-security.html</a> .
</p><p><br />
</p>
<h2> <span class="mw-headline" id="Literatura"> Literatura </span></h2>
<ul><li> Nginx HTTP Server - Clement Nedelcu; 2010.
</li><li> <a href="http://wiki.nginx.org/Main" class="external free" rel="nofollow">http://wiki.nginx.org/Main</a>
</li><li> <a href="http://www.aosabook.org/en/nginx.html" class="external free" rel="nofollow">http://www.aosabook.org/en/nginx.html</a>
</li><li> <a href="http://www.cyberciti.biz/tips/linux-unix-bsd-nginx-webserver-security.html" class="external free" rel="nofollow">http://www.cyberciti.biz/tips/linux-unix-bsd-nginx-webserver-security.html</a>
</li></ul>
<h2> <span class="mw-headline" id="Podjela_rada">Podjela rada</span></h2>
<ul><li>Luka Rajčević
<ul><li> Uvod
</li><li> Karakteristike Nginx-a
</li><li> Reverse proxy
</li><li> Instalacija nginx-a
</li><li> Konfiguracija PHP-a na nginxu
</li></ul>
</li></ul>
<ul><li>Davor Tomala
<ul><li> Arhitektura 
</li><li> Struktura koda
</li><li> Worker
</li><li> Uloge procesa
</li><li> Sigurnost (najbolja praksa)
</li></ul>
</li></ul>

<!-- 
NewPP limit report
Preprocessor node count: 757/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key sisds:pcache:idhash:4418-0!*!0!!hr!2!edit=0 and timestamp 20190203204051 -->
<div class="printfooter">
Dobavljeno iz "<a href="Nginx.html">http://security.foi.hr/wiki/index.php/Nginx</a>"</div>
				<!-- /bodytext -->
								<!-- catlinks -->
				<div id='catlinks' class='catlinks catlinks-allhidden'></div>				<!-- /catlinks -->
												<div class="visualClear"></div>
			</div>
			<!-- /bodyContent -->
		</div>
		<!-- /content -->
		<!-- header -->
		<div id="mw-head" class="noprint">
			
<!-- 0 -->
<div id="p-personal" class="">
	<h5>Osobni alati</h5>
	<ul>
					<li  id="pt-login"><a href="http://security.foi.hr/wiki/index.php?title=Posebno:Prijava&amp;returnto=Nginx" title="Predlažemo Vam da se prijavite, ali nije obvezno. [o]" accesskey="o">Prijavi se</a></li>
			</ul>
</div>

<!-- /0 -->
			<div id="left-navigation">
				
<!-- 0 -->
<div id="p-namespaces" class="vectorTabs">
	<h5>Imenski prostori</h5>
	<ul>
					<li  id="ca-nstab-main" class="selected"><span><a href="Nginx.html"  title="Pogledaj sadržaj [c]" accesskey="c">Članak</a></span></li>
					<li  id="ca-talk" class="new"><span><a href="http://security.foi.hr/wiki/index.php?title=Razgovor:Nginx&amp;action=edit&amp;redlink=1"  title="Razgovor o stranici [t]" accesskey="t">Razgovor</a></span></li>
			</ul>
</div>

<!-- /0 -->

<!-- 1 -->
<div id="p-variants" class="vectorMenu emptyPortlet">
		<h5><span>Inačice</span><a href="Nginx.html#"></a></h5>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>

<!-- /1 -->
			</div>
			<div id="right-navigation">
				
<!-- 0 -->
<div id="p-views" class="vectorTabs">
	<h5>Pogledi</h5>
	<ul>
					<li id="ca-view" class="selected"><span><a href="Nginx.html" >Čitaj</a></span></li>
					<li id="ca-viewsource"><span><a href="http://security.foi.hr/wiki/index.php?title=Nginx&amp;action=edit"  title="Ova stranica je zaštićena. Možete pogledati izvorni kod. [e]" accesskey="e">Vidi izvor</a></span></li>
					<li id="ca-history" class="collapsible "><span><a href="http://security.foi.hr/wiki/index.php?title=Nginx&amp;action=history"  title="Ranije izmjene na ovoj stranici. [h]" accesskey="h">Vidi stare izmjene</a></span></li>
			</ul>
</div>

<!-- /0 -->

<!-- 1 -->
<div id="p-cactions" class="vectorMenu emptyPortlet">
	<h5><span>Radnje</span><a href="Nginx.html#"></a></h5>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>

<!-- /1 -->

<!-- 2 -->
<div id="p-search">
	<h5><label for="searchInput">Traži</label></h5>
	<form action="http://security.foi.hr/wiki/index.php" id="searchform">
		<input type='hidden' name="title" value="Posebno:Traži"/>
				<input id="searchInput" name="search" type="text"  title="Pretraži ovaj wiki [f]" accesskey="f"  value="" />
		<input type='submit' name="go" class="searchButton" id="searchGoButton"	value="Kreni" title="Idi na stranicu s ovim imenom ako ona postoji" />
		<input type="submit" name="fulltext" class="searchButton" id="mw-searchButton" value="Traži" title="Traži ovaj tekst na svim stranicama" />
			</form>
</div>

<!-- /2 -->
			</div>
		</div>
		<!-- /header -->
		<!-- panel -->
			<div id="mw-panel" class="noprint">
				<!-- logo -->
					<div id="p-logo"><a style="background-image: url(../../images/osslogo.png);" href="../../wiki.html"  title="Glavna stranica"></a></div>
				<!-- /logo -->
				
<!-- navigation -->
<div class="portal" id='p-navigation'>
	<h5>Orijentacija</h5>
	<div class="body">
				<ul>
					<li id="n-mainpage-description"><a href="../../wiki.html" title="Posjeti glavnu stranicu [z]" accesskey="z">Glavna stranica</a></li>
					<li id="n-portal"><a href="http://security.foi.hr/wiki/index.php/SIS_Wiki:Portal_zajednice" title="O projektu, što možete učiniti, gdje je što">Portal zajednice</a></li>
					<li id="n-currentevents"><a href="http://security.foi.hr/wiki/index.php/SIS_Wiki:Novosti" title="O trenutačnim događajima">Aktualno</a></li>
					<li id="n-recentchanges"><a href="./Posebno:Nedavne_promjene.html" title="Popis nedavnih promjena u wikiju. [r]" accesskey="r">Nedavne promjene</a></li>
					<li id="n-randompage"><a href="./Posebno:Slučajna_stranica.html" title="Učitaj slučajnu stranicu [x]" accesskey="x">Slučajna stranica</a></li>
					<li id="n-help"><a href="./Pomoć:Pomoć.html" title="Mjesto za pomoć suradnicima.">Pomoć</a></li>
				</ul>
			</div>
</div>

<!-- /navigation -->

<!-- SEARCH -->

<!-- /SEARCH -->

<!-- TOOLBOX -->
<div class="portal" id="p-tb">
	<h5>Traka s alatima</h5>
	<div class="body">
		<ul>
					<li id="t-whatlinkshere"><a href="http://security.foi.hr/wiki/index.php/Posebno:%C5%A0to_vodi_ovamo/Nginx" title="Popis svih stranica koje sadrže poveznice ovamo [j]" accesskey="j">Što vodi ovamo</a></li>
						<li id="t-recentchangeslinked"><a href="http://security.foi.hr/wiki/index.php/Posebno:Povezane_promjene/Nginx" title="Nedavne promjene na stranicama na koje vode ovdašnje poveznice [k]" accesskey="k">Povezane stranice</a></li>
																																										<li id="t-specialpages"><a href="./Posebno:Posebne_stranice.html" title="Popis posebnih stranica [q]" accesskey="q">Posebne stranice</a></li>
									<li id="t-print"><a href="http://security.foi.hr/wiki/index.php?title=Nginx&amp;printable=yes" rel="alternate" title="Verzija za ispis ove stranice [p]" accesskey="p">Verzija za ispis</a></li>
						<li id="t-permalink"><a href="http://security.foi.hr/wiki/index.php?title=Nginx&amp;oldid=17273" title="Trajna poveznica na ovu verziju stranice">Trajna poveznica</a></li>
						</ul>
	</div>
</div>

<!-- /TOOLBOX -->

<!-- LANGUAGES -->

<!-- /LANGUAGES -->
			</div>
		<!-- /panel -->
		<!-- footer -->
		<div id="footer">
											<ul id="footer-info">
																	<li id="footer-info-lastmod"> Datum zadnje promjene na ovoj stranici: 23:00, 20. siječnja 2013.</li>
																							<li id="footer-info-viewcount">Ova stranica je pogledana 8.937 puta.</li>
																							<li id="footer-info-copyright">Sadržaji se koriste u skladu s <a href="http://creativecommons.org/licenses/by-sa/3.0/" class="external ">Creative Commons Attribution Share Alike</a>.</li>
															</ul>
															<ul id="footer-places">
																	<li id="footer-places-privacy"><a href="http://security.foi.hr/wiki/index.php/SIS_Wiki:Za%C5%A1tita_privatnosti" title="SIS Wiki:Zaštita privatnosti">Zaštita privatnosti</a></li>
																							<li id="footer-places-about"><a href="./SIS_Wiki:O_projektu_SIS_Wiki.html" title="SIS Wiki:O projektu SIS Wiki">O projektu SIS Wiki</a></li>
																							<li id="footer-places-disclaimer"><a href="http://security.foi.hr/wiki/index.php/SIS_Wiki:General_disclaimer" title="SIS Wiki:General disclaimer">Odricanje od odgovornosti</a></li>
															</ul>
											<ul id="footer-icons" class="noprint">
					<li id="footer-copyrightico">
						<a href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="../skins/common/images/cc-by-sa.png" alt="Creative Commons Attribution Share Alike" width="88" height="31" /></a>
					</li>
					<li id="footer-poweredbyico">
						<a href="http://www.mediawiki.org/"><img src="../skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" width="88" height="31" /></a>
					</li>
				</ul>
						<div style="clear:both"></div>
		</div>
		<!-- /footer -->
		
<script src="../load.php%3Fdebug=false&amp;lang=hr&amp;modules=startup&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>if ( window.mediaWiki ) {
	mediaWiki.config.set({"wgCanonicalNamespace": "", "wgCanonicalSpecialPageName": false, "wgNamespaceNumber": 0, "wgPageName": "Nginx", "wgTitle": "Nginx", "wgAction": "view", "wgArticleId": 4418, "wgIsArticle": true, "wgUserName": null, "wgUserGroups": ["*"], "wgCurRevisionId": 17273, "wgCategories": [], "wgBreakFrames": false, "wgRestrictionEdit": [], "wgRestrictionMove": []});
}
</script>
<script>if ( window.mediaWiki ) {
	mediaWiki.loader.load(["mediawiki.util", "mediawiki.legacy.wikibits", "mediawiki.legacy.ajax"]);
	mediaWiki.loader.go();
}
</script>

<script>if ( window.mediaWiki ) {
	mediaWiki.user.options.set({"ccmeonemails":0,"cols":80,"contextchars":50,"contextlines":5,"date":"default","diffonly":0,"disablemail":0,"disablesuggest":0,"editfont":"default","editondblclick":0,"editsection":1,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":0,"extendwatchlist":0,"externaldiff":0,"externaleditor":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"highlightbroken":1,"imagesize":2,"justify":0,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nocache":0,"noconvertlink":0,"norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"quickbar":1,"rcdays":7,"rclimit":50,"rememberpassword":0,"rows":25,"searchlimit":20,"showhiddencats":0,"showjumplinks":1,"shownumberswatching":1,"showtoc":1,"showtoolbar":1,"skin":"vector","stubthreshold":0,"thumbsize":2,"underline":2,"uselivepreview":0,"usenewrc":0,"watchcreations":0,"watchdefault":0,"watchdeletion":0,
	"watchlistdays":3,"watchlisthideanons":0,"watchlisthidebots":0,"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"wllimit":250,"variant":"hr","language":"hr","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false});;mediaWiki.loader.state({"user.options":"ready"});
}
</script>		<!-- fixalpha -->
		<script type="text/javascript"> if ( window.isMSIE55 ) fixalpha(); </script>
		<!-- /fixalpha -->
		<!-- Served in 0.691 secs. -->			</body>
</html>
